<div class="container-fluid">
  <app-page-title title="Orders" [breadcrumbItems]="breadCrumbItems"></app-page-title>

  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-body">
          <div class="row mb-2">
            <div class="col-sm-4">
              <div class="search-box me-2 mb-2 d-inline-block">
                <div class="position-relative">
                  <input type="text" class="form-control" autocomplete="off" id="searchTableList" placeholder="Search..." [(ngModel)]="term" (ngModelChange)="searchOrder()">
                  <i class="bx bx-search-alt search-icon"></i>
                </div>
              </div>
            </div>
            <div class="col-sm-8">
              <div class="text-sm-end">
                <button type="button" class="btn btn-success btn-rounded mb-2 me-2" (click)="navigateToCart()"><i class="mdi mdi-plus mr-1"></i>
                  Add New Order</button>
              </div>
            </div>
          </div>

          <!-- Table data -->
          <div class="table-responsive mb-0" style="height: 600px; overflow-y: auto;">
            <table class="table align-middle table-nowrap dt-responsive nowrap w-100 table-check" id="order-list">
              <thead class="table-light">
                <tr>
                  <th style="width: 20px;">
                    <div class="form-check font-size-16 align-middle">
                      <input class="form-check-input" type="checkbox" id="transactionCheck01" [(ngModel)]="masterSelected" (change)="checkUncheckAll($event)">
                      <label class="form-check-label" for="transactionCheck01"></label>
                    </div>
                  </th>
                  <th class="align-middle">Order ID</th>
                  <th class="align-middle">Factures ID</th>
                  <th class="align-middle">Billing Name</th>
                  <th class="align-middle">Date</th>
                  <th class="align-middle">Total</th>
                  <th class="align-middle">Amount Paid</th>
                  <th class="align-middle">Remaining Amount</th>
                  <th class="align-middle">Status</th>
                  <th class="align-middle">Action</th>
                </tr>
              </thead>
              <tbody>
                <!-- Loop through orders -->
                <tr *ngFor="let data of orderlist; let i = index">
                  <td>
                    <div class="form-check font-size-16">
                      <input class="form-check-input" type="checkbox" id="transactionCheck{{i}}" value="{{data.id}}" [(ngModel)]="data.state">
                      <label class="form-check-label" for="transactionCheck{{i}}"></label>
                    </div>
                  </td>
                  <td><a href="javascript:void(0);" class="text-body fw-bold">{{data.id}}</a></td>
                  <td>{{data.invoiceNumber}}</td>
                  <td>{{data.name}}</td>
                  <td>{{data.date}}</td>
                  <td>{{data.total}}</td>
                  <td>{{data.amountPaid.toFixed(2)}} </td>
                  <td>{{data.remainingAmount.toFixed(2)}} </td>
                  <td>
                    <span class="badge rounded-pill" [ngClass]="{
                      'bg-success': data.status === 'Paid',
                      'bg-danger': data.status === 'Unpaid'
                    }">{{data.status}}</span>
                  </td>
                  <td>
                    <div class="dropdown">
                      <button class="btn btn-link dropdown-toggle action-button" type="button" id="actionDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="mdi mdi-dots-vertical"></i>
                      </button>
                      <ul class="dropdown-menu" aria-labelledby="actionDropdown">
                        <li><a class="dropdown-item" href="javascript:void(0)" (click)="navigateToInvoiceDetail(data.id)"><i class="mdi mdi-eye"></i> View Details</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <!-- NEW: Edit options -->
                        <li><a class="dropdown-item" href="javascript:void(0)" (click)="editOrder(data.id)"><i class="mdi mdi-pencil"></i> Edit Order </a></li>
                        <!-- <li><a class="dropdown-item" href="javascript:void(0)" (click)="editOrderBasicInfo(data)"><i class="mdi mdi-pencil-outline"></i> Quick Edit</a></li> -->
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="javascript:void(0)" (click)="downloadPdf(data)"><i class="mdi mdi-download"></i> Download PDF</a></li>
                        <li><a class="dropdown-item text-danger" href="javascript:void(0)" (click)="deleteSale(data)"><i class="mdi mdi-trash-can-outline"></i> Delete Sale</a></li>
                      </ul>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <!-- Pagination controls -->
          <div class="d-flex justify-content-between align-items-center mt-3">
            <div class="pagination-info">
              <span>Showing {{(pageIndex * pageSize) + 1}} to {{(pageIndex + 1) * pageSize}} of {{totalItems}} orders</span>
            </div>
            <pagination [totalItems]="totalItems" [itemsPerPage]="pageSize" (pagechanged)="pageChanged($event)"></pagination>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>